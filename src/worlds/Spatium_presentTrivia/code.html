<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Trivia Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 <!--<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>   -->
  <!-- Circles' head scripts [REQUIRED] -->
  <circles-start-scripts/>
 

  <style>
    html,
    body {
      height: 100%;
    }

    /* Add colors to the start button */
    button {
      background-color: #206fe6;
      color: white;
      font-size: 1.5em;
      padding: 0.5em 1em;
      border: none;
      border-radius: 0.2em;
      cursor: pointer;
      margin-top: 1em;
    }

    

    button:hover {
      background-color: #004a9a;
    }

    .center {
      position: absolute;
      top: 50%;
      left: 50%;
    }
 
  </style>

<!-- Start Button -->
  <div class="center">
    <button id="button" onclick="startGame()">Start Game</button>
  </div>

</head>

<body>

 <!-- this is used to create our enter UI that creates a 2D overlay to capture a user gesture for sound/mic access etc. -->
 <circles-start-ui/>

 <!-- a-scene with 'circles-properties' component [REQUIRED] -->
 <a-scene circles_scene_properties>
   <a-assets>

     <!-- Circles' built-in assets [REQUIRED] -->
     <circles-assets/>
   </a-assets>

   <!-- Circles' built-in manager and avatar [REQUIRED] -->
   <circles-manager-avatar/>
 </a-scene>

 <!-- Circles' end scripts [REQUIRED] -->
 <circles-end-scripts/>
 
  <script>

let score = 0;

// Fuction to begin game
function startGame() {
  
  // Hide the start button 
  const startButton = document.querySelector('button');
  startButton.style.display = 'none';

  // Show the scene
  const scene = document.querySelector('#scene');
  scene.style.display = 'block';

  // Initialize the game
  setNewQuestion();

  // Show the question text
  const questionEntity = document.querySelector('#question-text');
  questionEntity.setAttribute('visible', true);
  
 

}

// Shuffle through the questions
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// Track how many times setNewQuestion is called
let questionCount = 0;

function setNewQuestion() {

  const questions = [
    {
      question: 'What does NASA stand for?',
      answers: [
        { text: 'National Aeronautics and Space Administration', correct: true },
        { text: 'National Airplane for Space Aliens', correct: false },
        { text: 'Nautical Astronaunt and Solar Air', correct: false },
        { text: 'Neon Air and Space Adventure', correct: false }
      ]
    },
    {
      question: 'What does MOXIE do?',
      answers: [
        { text: 'Create oxygen', correct: true },
        { text: 'Collect rocks', correct: false },
        { text: 'Record footage', correct: false },
        { text: 'Communicate with aliens', correct: false }
      ]
    },
    {
      question: 'Where did Apollo 11 launch?',
      answers: [
        { text: 'The Kennedy Space Centre', correct: true},
        { text: 'Elon Musks House', correct: false },
        { text: 'The Space Centre', correct: false },
        { text: 'Launchers Headquarters', correct: false }
      ]
    },
    {
      question: 'When are humans expected to walk on Mars?',
      answers: [
        { text: '2030', correct: true},
        { text: '2023', correct: false },
        { text: '2050', correct: false },
        { text: '2031', correct: false }
      ]
    },
    {
      question: 'What flag was placed on the moon?',
      answers: [
        { text: ' American ', correct: true},
        { text: 'Canadian ', correct: false },
        { text: 'United Kingdom ', correct: false },
        { text: 'Russia', correct: false }
      ]
    },
  ];

const questionContainer = document.getElementById('question');
const answerContainer = document.getElementById('answers');


  // Get a random question and its answers
  const randomIndex = Math.floor(Math.random() * questions.length);
  const question = questions[randomIndex];
  const answers = question.answers;

  // Shuffle the answers
  shuffleArray(answers);

  // Set the question text
  const questionText = document.querySelector('#question-text');
  questionText.setAttribute('value', question.question);

  // Set the answer texts
  const answerEntities = document.querySelectorAll('.answer');
  for (let i = 0; i < answerEntities.length; i++) {
    const answerEntity = answerEntities[i];
    const answer = answers[i];
    const answerText = answerEntity.querySelector('a-text');
    answerText.setAttribute('value', answer.text);
    answerEntity.setAttribute('answer', 'correct:' + answer.correct);
  }
  questionCount++
  
// Remove the used question from the questions array
questions.splice(randomIndex, 1);
  console.log(questionCount);

// Check if there are any questions left
if (questionCount === 6) {
// For testing purposes
console.log("Game over");
const imageEntity = document.createElement("a-image");
        imageEntity.setAttribute("src", "gameover.png");
        imageEntity.setAttribute("position", "0 1 -3");
            imageEntity.setAttribute("width", "5");
            imageEntity.setAttribute("height", "3");

        // Append the entity to the scene
        const sceneEl = document.querySelector("a-scene");
        sceneEl.appendChild(imageEntity);

// Hide question and answers
questionText.setAttribute('visible', false);
answerEntities.forEach((entity) => {
  entity.setAttribute("visible", false);


});
}
}


// Check if user's answer is correct 
AFRAME.registerComponent("check-answer", {
  init: function() {

    this.correctAnswer = function(e) {
      const isCorrect = e.srcElement.getAttribute("answer");

      if (isCorrect == "correct:true") {
        console.log("You're right " + isCorrect);
       
       console.log("your score %i", score);

       score++;
         // Set the question text
       const scoreText = document.querySelector('#score-text');
      scoreText.setAttribute('value', score);
       
        // Create an A-Frame entity that displays the image
        const imageEntity = document.createElement("a-image");
        imageEntity.setAttribute("src", "check.png");
        imageEntity.setAttribute("position", "0 1.5 -4");
        
      

        // Append the entity to the scene
        const sceneEl = document.querySelector("a-scene");
        sceneEl.appendChild(imageEntity);

        // Remove the entity after 2 seconds
        setTimeout(() => {
          sceneEl.removeChild(imageEntity);
          setNewQuestion();
        }, 1500);
      } else {
        console.log("Wrong");
        console.log("your score %i", score);
        // Create an A-Frame entity that displays the image
        const imageEntity = document.createElement("a-image");
        imageEntity.setAttribute("src", "wrong.png");
        imageEntity.setAttribute("position", "0 1.5 -3");

        // Append the entity to the scene
        const sceneEl = document.querySelector("a-scene");
        sceneEl.appendChild(imageEntity);

        // Remove the entity after 2 seconds
        setTimeout(() => {
          sceneEl.removeChild(imageEntity);
          setNewQuestion();
        }, 1500);
      }
      score;
    };

    this.el.addEventListener("click", this.correctAnswer);
  },

  remove: function() {
    this.el.removeEventListener("click", this.correctAnswer);
  },
});

</script>
  </script>

  <a-scene id="scene" style="display:none">
       

<a-entity id="finalScore" position="-3 3 -5" >
  <a-text value="0" type="number"  id="score-text" font="monoid" color="white"></a-text>
</a-entity>
<a-entity id="finalScore" position="-4 3 -5" >
  <a-text value="Score ="  id="stext" font="monoid" color="white"></a-text>
</a-entity>
      <a-camera>
        <a-cursor></a-cursor>
      </a-camera>

      <a-assets>
        <img id="sky" src="space.jpg">
      </a-assets>
      <a-sky src="#sky"></a-sky>

    <a-scene update-html id="scene" style="display:none" cursor="rayOrigin: mouse">
      <a-box id="question0" check-answer>
    <a-entity id="question" position="-1.5 2 -5" >
      <a-text value="" id="question-text" font="monoid" font-size="1.5" color="black"></a-text>
    </a-entity>
    </a-box>

    
    <a-plane height="3" width="11"  color = "white"
           rotation = "4 0 0" position="0 1 -5.5"
           ></a-plane>



    

     <!-- Questions -->
    <a-box id="question1" check-answer>
    <a-entity id="question" position="-2 2 -5" >
      <a-text value="" id="question-text" font="monoid"></a-text>
    </a-entity>
  </a-box>
  <a-box id="2" check-answer >
    <a-entity id="question2" position="-4 1.5 -5" class="answer" data-answer="correct:true" geometry="primitive: plane; width:2; height: 0.5" text-align: center; material="color: white" >
      <a-text value="" color="black" font="monoid"></a-text>
    </a-entity>
  </a-box>
  <a-box id="3" check-answer>
    <a-entity id="question3" position="2 1.5 -5" class="answer" data-answer="correct:false" geometry="primitive: plane; width: 3; height: 0.5" align: center; material="color: white">
      <a-text value="" color="black" font="monoid"></a-text>
    </a-entity>
  </a-box>
  <a-box id="4" check-answer>
    <a-entity id="question4" position="-4 0.5 -5" class="answer" data-answer="correct:false" geometry="primitive: plane; width: 2; height: 0.5" align: center; material="color: white">
      <a-text value="" color="black" font="monoid"></a-text>
    </a-entity>
  </a-box>
  <a-box id="5" check-answer>
    <a-entity id="question5" position="2 0.5 -5"  class="answer" data-answer="correct:false" geometry="primitive: plane; width: 3; height: 0.5" align: center; material="color: white">
      <a-text value="" color="black" font="monoid"></a-text>
    </a-entity>
  </a-box>

  <a-entity id="hub_link"
                position="1 2 0" rotation="0 180 0" scale="1 1 1"
                circles-portal="img_src:#link_1_360; title_text:Spatium Hub; link_url:/w/Spatium_Hub"></a-entity>
  <a-entity position="0 1.6 -2">

    <a-sound src="triviamusic.mp3" autoplay="true"></a-sound>
  </a-entity>


  <div id="question"></div>
  <div id="answers"></div>
  </a-scene>
</body>

</html>
